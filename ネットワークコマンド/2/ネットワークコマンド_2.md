# ネットワークコマンドでネットワークの仕組みを確認する（ping, tracert 編）
##　はじめに
普段何気なく使用しているネットワーク、仕組みを理解していなくても問題なく使えていると思います。  
ですが、仕組みを知ることで、トラブルシューティング能力を高めたり、セキュリティへの理解を深めたり、効率的な使い方を見つけたりすることが可能になります。  
本記事は **「ネットワークを使っているけれど、その仕組みはよくわかっていない」** という人に向けて書かれています。  
基本的なネットワークコマンドを使って、ネットワークの仕組みを可視化し、一緒に理解していきましょう。 

> 参考文献：[コンピュータはなぜ動くのか 第２版 知っておきたいハードウエア＆ソフトウエアの基礎知識](https://amzn.asia/d/f8jp2tW)

**▼ネットワークコマンドの例**
| コマンド | 機能                          |
| :------- | :---------------------------- |
| ipconfig | ネットワークの設定を確認する  |
| ping     | 通信相手に応答を要求する      |
| tracert  | 通信相手までの経路を調べる    |
| nslookup | DNSサーバーに問い合わせをする |
| netstat  | 通信状態を確認する            |
| arp      | ARPテーブルの内容を確認する   |


## 確認3：DHCPサーバーの役割を知る
IPアドレスとサブネット・マスクは、ソフトウェア的に設定するものです。（状況に合わせて任意に設定できる）  
手作業で任意の数値に設定することもできますが、**多くの場合に自動設定を利用し**ます。  
  
コマンドプロンプトを開き、以下のコマンドを入力してください。  

**`ipconfig /all`**  

[ここに実行したスクショを貼る]  

表示された情報の中で、「DHCP有効」と「DHCPサーバー」の部分に注目してください。  
多くの場合に「DHCP有効」が「はい」になっていて、「DHCPサーバー」のIPアドレスが示されているはずです。  

> **< DHCP >**
> 「Dynamic Host Configuration Protocol」（動的にホストを設定するプロトコル）の略  
> DHCPサーバーは、**ホストにIPアドレスとサブネット・マスクなどを自動的に設定する**  

DHCPサーバーは、LAN内のコンピュータに割り当てられるIPアドレスの範囲とサブネット・マスクなどの値などを記憶しています。  
新たなホストをLANに接続すると、**DHCPサーバーから、他のホストに割り当てられていないIPアドレス**が知らされます。  

また、`ipconfig /all`を実行して表示された情報に含まれる、「デフォルトゲートウェイ」と「DNSサーバー」のIPアドレスも確認します。  

> **< デフォルトゲートウェイ >**
> LANとインターネットを繋ぐ最初のルーター  

> **< DNSサーバー >**
> ドメイン名に対応するIPアドレスを知らせるサーバー
> ※ドメイン名とは、Webサーバーを識別する「www.nextvision.co.jp」や、メールアドレスの「nextvision.co.jp」の部分のこと  

自宅のLANには、デフォルトゲートウェイ、DHCPサーバー、DNSサーバーのIPアドレスが全て同じになっていることが多いです。  
これは、**デフォルトゲートウェイであるルーターが、DHCPサーバーとDNSサーバーの機能を持っている**からです。  
大規模な企業のLANでは、それぞれが別の役割を持つコンピュータを用意するのが一般的です。  

## 確認4：デフォルトゲートウェイにPINGを送る
`ping`コマンドを使用すると、**通信相手に応答を要求する**ことができます。  
応答が帰ってくれば、通信相手が動作中（通信経路が通っている）ことが確認できます。  

`ping`の後にスペースで区切ってIPアドレスを指定することができます。  
コマンドプロンプトを開き、以下のコマンドを入力してください。  
ここでは例として、`8.8.8.8`（google が用意してくれている公開DNSサーバーのIPアドレス）を指定してPINGを送ってみます。 

**`ping 8.8.8.8`**  

[ここに実行したスクショを貼る]  

PINGは続けて4回送られます。  
「バイト数＝32」は、通信相手に送ったデータのサイズです。  
デフォルトで 32バイトのデータを送るので、それを受信できていることがわかります。  
「時間 <XXms」は、応答に要した時間です。  
「TTL＝XX」は、「Time To Alive（生存時間）」の略です。  
通信相手からの通信がルーターを経由するたびに1ずつ減り、0になるとデータが破棄されるようになっています。  

次に、`tracert`コマンドを使用し、googleのDNSサーバーまでの**通信経路を調査**してみます。  
コマンドプロンプトを開き、以下のコマンドを入力してください。  

**`tracert 8.8.8.8`**

[ここに実行したスクショを貼る] 

`tracert`を実行すると、**指定した通信相手までの経路上にあるルーターのIPアドレス（またはドメイン名）が、順に応答時間と一緒に表示**されます。  
表示される内容は以下のように見ます。  

1. 番号
   コンピュータに近い方が小さい数字になる
2. ルーターの応答時間
   3回実行された結果が表示される
3. ルーターのIPアドレスまたはドメイン名
   IPからドメイン名が特定できた場合、ドメイン名が表示される

## おわりに
前回に引き続き、`ipconfig`を使用して、LANの管理に重要である「DHCPサーバー」「デフォルトゲートウェイ」「DNSサーバー」について確認しました。  
また、`ping`コマンドや`tracert`コマンドを使用することで外部のインターネットへの通信を可視化しました。  
実際に通信の経路を確認すると、ネットワークが多岐にわたって構成されていることがわかると思います。  

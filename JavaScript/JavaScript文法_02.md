# JavaScript文法 ②

## 関数

``` javascript
// 関数は引数を渡して呼び出すことのできるJavaScriptコードブロック。
// 「x」と言うパラメータを持つ「plus1」と言う名前の関数を定義する。
function plus1(x) {
  return x + 1;      // 引数として渡された値に1を加えて返す。
}                    // 関数の定義は波括弧で囲む。
const y = 3;         // 例として、yを定義
plus1(y)             // => 4: 関数を呼び出すと、3 + 1 の計算結果を返す。

let square = function(x) { // 関数は値なので、変数に代入できる。
  return x * x;            // 関数の値を計算する。
};                         // セミコロンで関数の代入を終了する。
square(plus1(y))           // => 16 (4*4): 1つの式で2つの関数を呼び出す。

// アロー関数
// アロー関数は、より短い構文で関数を定義できる。
const plus1 = x => x + 1;   // 入力xに対して、x + 1が出力される。
const square = x => x * x;  // 入力xに対して、x * xが出力される。
plus1(y)                    // => 4: 関数の呼び出し方法は同じ。
square(plus1(y))            // => 16

// 関数をオブジェクトとともに使うと、メソッドになる。
// 関数がオブジェクトのプロパティに代入されると、この関数のことを「メソッド」と呼ぶ。
// 全てのJavaScriptオブジェクト（配列も含む）はデフォルトでメソッドを持つ（組み込みメソッド）。
let a = [];              // 空の配列を生成する。
a.push(1, 2, 3);         // push()メソッドは、配列に要素を追加する。
a.reverse();             // reverse()メソッドは、配列の要素を逆順にする。

// 独自のメソッドも定義できる。「this」キーワードで、メソッドが定義されているオブジェクトを参照できる。
// この例の場合は、2つのオブジェクト要素を持つpoints配列を参照する。
let points = [
  {x: 0, y: 0},
  {x: 1, y: 1}
];

// 2点間の距離を計算するメソッドを定義する。
points.dist = function() {
  let p1 = this[0];      // メソッドが呼び出された配列の最初の要素を取得する。
  let p2 = this[1];      // 「this」オブジェクトの2番目の要素を取得する。
  let a = p2.x - p1.x;   // X座標の距離を計算する。
  let b = p2.y - p1.y;   // Y座標の距離を計算する。
  return Math.sqrt(a*a + b*b); // ピタゴラスの定理で2点間の距離を計算する。（Math.sqrt()は平方根を計算する）
};
points.dist()             // => Math.sqrt(2): 2点間の距離（メソッドの呼び出し）
```

## 制御文

``` javascript
// JavaScriptには、CやC++、Javaなどで使われているような条件分やループ文が用意されている。
// 絶対値を計算する関数。
function abs(x) {
  if (x >= 0) {    // if文は、条件によって処理を分岐する。
    return x;      // 条件が真の場合は、このブロックが実行される。
  } 
  else {           // else節は必要なければ省略可能。
    return -x;     // 条件が偽の場合は、このブロックが実行される。
  }
}
abs(-10) === abs(10) // => true

// 配列の要素を合計する関数。
function sum(array) {
  let sum = 0;            // 合計を計算する変数を初期化する。
  for (let x of array) {  // 配列をループし、各要素を順にxに代入する。
    sum += x;             // sumに各要素の値を加算する。
  }
  return sum;             // 合計を返す。
}
const primes = [2, 3, 5, 7, 11];
sum(primes) // => 28: 5番目までの素数の合計 2+3+5+7+11

// 階乗を計算する関数。
function factrial(n) {
  let product = 1; // 積を計算する変数を初期化する。
  while (n > 1) {  // while文は条件が真の間、ループを続ける。
    product *= n;  // productにnを乗算する。
    n--;           // nをデクリメントする。
  }
  return product;  // 積を返す。
}
factrial(4)        // => 24: 4の階乗 1*4*3*2

// ループ方法を変えた関数。
function factorial2(n) {
  let i, product = 1;   // 1からスタート。
  for(i=2; i <= n; i++) // 変数iを2からnまでインクリメントさせながらループする。
    product *= i;       // ループごとに実行される。文は1行なので、波括弧は省略可能。
  return product;       // 階乗の計算結果を返す。
}
factorial2(5)           // => 120: 5の階乗 1*2*3*4*5
```

## クラス

``` javascript
// クラス名は大文字から記述するのが慣習。
class Point {
  // 新しいインスタンスを初期化するコンストラクタ関数。
  constructor(x, y) {
    this.x = x;       // thisキーワードで、初期化中のオブジェクトを参照できる。
    this.y = y;       // 関数の引数をオブジェクトのプロパティに代入する。
  }

  // 原点からの距離を計算するメソッド。
  distance() {
    // 2点間の距離を計算する。
    return Math.sqrt(
      this.x * this.x + this.y * this.y // thisが参照しているのは、distanceメソッドが呼び出されているPointオブジェクト。
    );
  }
}

// 「new」キーワードとPoint()コンストラクタ関数を使って、Pointオブジェクトを生成する。
let p = new Point(1, 1); // 座標(1, 1)のPointオブジェクトを生成する。

// Pointオブジェクトpのメソッドを使う。
p.distance() // => Math.sqrt(): 2点間の距離
```

# JavaScript 文の意味 一覧表

| 文 | 意味 |
| --- | --- |
| break | 最も内側のループ、switch文、ラベルで指定された文を終了する。 |
| case | switch文内の文にラベルを付ける。 |
| class | クラスを宜言する。 |
| const | 1つ以上の定数を宣言し初期化する。 |
| continue | 最も内側のループ文、または、ラベルで指定されたループ文を次のループに進める。 |
| debugger | デバッガ用のブレークポイントを指定する。 |
| default | switch文内のデフォルトの文にラベルを付ける。 |
| do/while | whileループの代替表記。 |
| export | ほかのモジュールからインポートできる変数を宣言する。 |
| for | 簡単に使えるループ。 |
| for/await | 非同期イテレータの値を反復する。 |
| for/in | オブジェクトのプロパテイを調べる。 |
| for/of | 配列などの反復可能なオブジェクトの値を調べる。 |
| function | 関数を宜言する。 |
| if/else | 条件によって実行する文を変更する。 |
| import | ほかのモジュールで定義された値に対して名前を宜言する。 |
| ラベル文 | break や continue で使えるよう文にラベルをつける。 |
| let | 1つ以上の変数を宣言し初期化する。この変数はブロックスコープを持つ（新しい構文）。 |
| return | 関数から値を返す。 |
| switch | case または default：でラベル付けした文に分岐する。 |
| throw | 例外をスローする。 |
| try/catch/finally | 例外を処理し、後始末を行う。 |
| "use strict" | スクリプトまたは関数に対して strictモードを適用する。 |
| var | 1つ以上の変数を宜言し初期化する（古い構文）。 |
| while | 基本的なループを作成する。 |
| with | 現在のスコープチェーンを拡張する（利用しないほうがよい。また、strictモードでは使用できない）。 |
| yield | 反復処理用に値を生成する。ジェネレータ関数中でのみ利用できる。 |